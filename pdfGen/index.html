<!DOCTYPE html>
<html>
<head>
  <title>PDF Generation Example</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf-lib/1.16.0/pdf-lib.js"></script>
  <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
  <style>
    #canvasContainer {
      position: relative;
      width: 100%;
      height: 500px;
    }
    #downloadButton {
      position: absolute;
      bottom: 10px;
      left: 10px;
      padding: 10px;
      background-color: #007bff;
      color: #fff;
      border: none;
      border-radius: 4px;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>PDF Generation Example</h1>

  <button onclick="generatePDF()">Generate PDF</button>

  <div id="canvasContainer" style="display: none;">
    <!-- Canvas elements will be added here. -->
    <button id="downloadButton" onclick="downloadPDF()">Download</button>
  </div>

  <script>
    const fetchImage = async (path) => {
      try {
        const response = await fetch(path);
        const imageBytes = await response.arrayBuffer();
      
        return new Uint8Array(imageBytes);
      } catch (error) {
        console.error("Error fetching image", error);
      }
    };
    
    const generatePDF = async () => {
      try {
        const { PDFDocument, rgb } = PDFLib;
        const pdfDoc = await PDFDocument.create();
      
        const page = pdfDoc.addPage();
      
        const [image1, image2] = await Promise.all([
          fetchImage('https://readthai.fun/imgWrite/%E0%B8%81.png'),
          fetchImage('https://readthai.fun/imgWrite/%E0%B8%82.png')
        ]);
      
        const pngImage1 = await pdfDoc.embedPng(image1);
        const pngImage2 = await pdfDoc.embedPng(image2);
      
        page.drawImage(pngImage1, { x: 50, y: page.getHeight() - 150, width: 100, height: 100 });
        page.drawImage(pngImage2, { x: 200, y: page.getHeight() - 150, width: 100, height: 100 });
      
        const pdfBytes = await pdfDoc.save();
        const pdfBlob = new Blob([pdfBytes], { type: 'application/pdf' });
        const pdfUrl = URL.createObjectURL(pdfBlob);
      
        const downloadButton = document.getElementById('downloadButton');
      
        downloadButton.style.display = 'inline';
      
        // Render the PDF as an image.
        const loadingTask = pdfjsLib.getDocument(pdfUrl);
        loadingTask.promise.then(async function(pdf) {
          const canvasContainer = document.getElementById('canvasContainer');
        
          for (let i = 1; i <= pdf.numPages; i++) {
            const page = await pdf.getPage(i);
          
            const viewport = page.getViewport({ scale: 1.0 });
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = viewport.width;
            canvas.height = viewport.height;
          
            const renderContext = {
              canvasContext: context,
              viewport: viewport
            };
            await page.render(renderContext).promise;
          
            canvasContainer.appendChild(canvas);
          }
        
          canvasContainer.style.display = 'block';
        });
      
        // Save the PDF URL for downloading.
        window.pdfUrl = pdfUrl;
      } catch (error) {
        console.error("Error generating PDF", error);
      }
    };
    
    const downloadPDF = () => {
      const link = document.createElement('a');
      link.href = window.pdfUrl;
      link.download = 'example.pdf';
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
    };
  </script>
</body>
</html>
